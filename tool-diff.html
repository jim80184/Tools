<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diff æª”æ¡ˆæ¯”å°å·¥å…·</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --accent-color: #4a90e2;
            --accent-hover: #357abd;
            --bg-color: #f4f6f8;
            --card-bg: #ffffff;
            --text-primary: #333;
            --text-secondary: #666;
            --border-color: #e1e4e8;
            --input-bg: #f8f9fa;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            
            /* Diff å°ˆç”¨é¡è‰² */
            --diff-add-bg: #d4edda;
            --diff-add-text: #155724;
            --diff-del-bg: #f8d7da;
            --diff-del-text: #721c24;
            --diff-mod-bg: #fff3cd;
            --diff-mod-text: #856404;
        }

        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--bg-color); padding: 20px; color: var(--text-primary); margin: 0; }
        * { box-sizing: border-box; }

        /* æ ¸å¿ƒå¡ç‰‡ - è¨­å¯¬ä¸€é»ä»¥å®¹ç´æ¯”å°è¦–çª— */
        .tool-card {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            max-width: 1400px; /* Diff éœ€è¦å¤§ç©ºé–“ */
            width: 100%;
            margin: 0 auto;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }

        h2 { margin: 0 0 20px 0; text-align: center; color: var(--accent-color); font-size: 24px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        
        /* --- æ§åˆ¶åˆ— --- */
        .controls-area {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 20px;
            background: var(--input-bg);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            align-items: center;
            margin-bottom: 20px;
        }

        .checkbox-group { display: flex; gap: 15px; margin-right: auto; }
        .checkbox-label { display: flex; align-items: center; cursor: pointer; user-select: none; font-size: 14px; }
        .checkbox-label input { margin-right: 6px; accent-color: var(--accent-color); transform: scale(1.1); }

        button {
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: 0.2s;
            border: 1px solid transparent;
            display: flex; align-items: center; gap: 6px;
        }
        .btn-primary { background-color: var(--accent-color); color: white; }
        .btn-primary:hover { background-color: var(--accent-hover); }
        .btn-outline { background: transparent; border: 1px solid var(--border-color); color: var(--text-primary); }
        .btn-outline:hover { border-color: var(--accent-color); color: var(--accent-color); background: #fff; }
        .btn-danger { background: transparent; border: 1px solid var(--danger-color); color: var(--danger-color); }
        .btn-danger:hover { background: var(--danger-color); color: white; }

        /* --- è¼¸å…¥å€ --- */
        .diff-input-wrapper { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        
        .input-box {
            background: #fff;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            display: flex; flex-direction: column;
            position: relative;
            transition: border-color 0.2s;
        }
        .input-box.drag-over { border-color: var(--accent-color); box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1); }

        .box-header {
            padding: 10px 15px;
            background: #f8f9fa;
            border-bottom: 1px solid var(--border-color);
            display: flex; justify-content: space-between; align-items: center;
            font-size: 13px; font-weight: 600; color: var(--text-secondary);
            border-radius: 8px 8px 0 0;
        }
        
        .diff-textarea {
            flex: 1;
            min-height: 250px;
            padding: 15px;
            border: none;
            resize: vertical;
            font-family: 'Roboto Mono', monospace;
            font-size: 13px;
            outline: none;
            border-radius: 0 0 8px 8px;
        }

        .drag-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.9);
            display: none; align-items: center; justify-content: center;
            font-weight: bold; color: var(--accent-color);
            z-index: 10; border-radius: 8px;
        }
        .input-box.drag-over .drag-overlay { display: flex; }

        /* --- æ¯”å°çµæœå€ --- */
        .diff-container {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            background: #fff;
            display: flex; flex-direction: column;
        }

        /* çµ±è¨ˆæ¢ */
        .diff-stats {
            display: flex; gap: 15px; padding: 10px 15px;
            background: #f1f3f5; border-bottom: 1px solid var(--border-color);
            font-size: 13px; flex-wrap: wrap; align-items: center;
        }
        .stat-badge {
            display: inline-flex; align-items: center; gap: 5px;
            padding: 4px 10px; border-radius: 4px; background: #fff;
            border: 1px solid var(--border-color); font-weight: bold;
        }
        .stat-badge.add { color: var(--success-color); border-color: var(--success-color); }
        .stat-badge.del { color: var(--danger-color); border-color: var(--danger-color); }
        .stat-badge.mod { color: var(--warning-color); border-color: var(--warning-color); }

        /* Minimap */
        .diff-minimap {
            height: 30px; background: #f8f9fa; border-bottom: 1px solid var(--border-color);
            display: flex; position: relative; overflow: hidden; cursor: pointer;
        }
        .minimap-content { flex: 1; display: flex; height: 100%; position: relative; }
        .minimap-line { flex: 1; height: 100%; min-width: 1px; }
        .minimap-line.added { background: var(--success-color); }
        .minimap-line.removed { background: var(--danger-color); }
        .minimap-line.modified { background: var(--warning-color); }
        .minimap-viewport {
            position: absolute; top: 0; bottom: 0;
            background: rgba(74, 144, 226, 0.2);
            border: 1px solid var(--accent-color);
            pointer-events: none;
        }

        /* å…§å®¹å€ */
        .diff-panels { display: grid; grid-template-columns: 1fr 1fr; border-top: 1px solid var(--border-color); }
        .diff-panel { overflow-x: auto; }
        
        .diff-line {
            display: grid;
            grid-template-columns: 50px 1fr;
            font-family: 'Roboto Mono', monospace;
            font-size: 13px;
            line-height: 22px;
            border-bottom: 1px solid #f5f5f5;
        }
        
        .line-num {
            background: #f8f9fa; color: #999; text-align: right; padding-right: 8px;
            border-right: 1px solid var(--border-color); user-select: none;
        }
        .line-content { padding-left: 10px; white-space: pre-wrap; word-break: break-all; }
        
        /* å·®ç•°æ¨£å¼ */
        .line-added { background: var(--diff-add-bg); color: var(--diff-add-text); }
        .line-removed { background: var(--diff-del-bg); color: var(--diff-del-text); }
        .line-modified { background: var(--diff-mod-bg); color: var(--diff-mod-text); }
        .line-empty { background: #fafafa; }
        
        .char-diff { font-weight: bold; border-bottom: 2px solid rgba(0,0,0,0.2); }

        /* å…¨è¢å¹•æ¨¡å¼ */
        body.fullscreen-active { padding: 0; overflow: hidden; }
        body.fullscreen-active .tool-card {
            max-width: 100%; height: 100vh; border-radius: 0; border: none; padding: 10px;
        }
        body.fullscreen-active .diff-textarea { min-height: 30vh; }
        body.fullscreen-active .diff-panels { flex: 1; overflow: auto; }

        /* Notification & Loading */
        .notification {
            position: fixed; bottom: 20px; right: 20px; padding: 12px 24px; 
            background: #333; color: #fff; border-radius: 8px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 1000;
            transform: translateY(100px); transition: transform 0.3s;
        }
        .notification.show { transform: translateY(0); }
        .notification.success { background: var(--success-color); }
        .notification.error { background: var(--danger-color); }
        
        .loading-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.8); z-index: 999;
            display: none; align-items: center; justify-content: center;
            backdrop-filter: blur(2px);
        }
        .loading-spinner {
            width: 40px; height: 40px; border: 4px solid var(--border-color);
            border-top-color: var(--accent-color); border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        @media (max-width: 768px) {
            .diff-input-wrapper, .diff-panels { grid-template-columns: 1fr; }
            .diff-panels { max-height: 500px; overflow-y: auto; }
        }
    </style>
</head>
<body>

<div class="tool-card">
    <h2>ğŸ”„ Diff æª”æ¡ˆæ¯”å°å·¥å…·</h2>

    <div class="controls-area">
        <div class="checkbox-group">
            <label class="checkbox-label"><input type="checkbox" id="ignoreWhitespace"> å¿½ç•¥ç©ºç™½</label>
            <label class="checkbox-label"><input type="checkbox" id="ignoreCase"> å¿½ç•¥å¤§å°å¯«</label>
        </div>
        <button class="btn-primary" onclick="compareTexts()">ğŸ” é–‹å§‹æ¯”å°</button>
        <button class="btn-danger" onclick="clearAll()">ğŸ—‘ï¸ æ¸…é™¤</button>
        <button class="btn-outline" onclick="toggleFullscreen()" id="fullscreenBtn">â›¶ å…¨è¢å¹•</button>
    </div>

    <div class="diff-input-wrapper">
        <div class="input-box" id="leftInputBox">
            <div class="box-header">
                <span id="leftFileName">ğŸ“„ æª”æ¡ˆ A (åŸå§‹)</span>
                <div>
                    <input type="file" id="leftFileInput" style="display:none" onchange="handleFileSelect('leftText', this)">
                    <button class="btn-outline" style="padding:2px 8px; font-size:12px;" onclick="document.getElementById('leftFileInput').click()">è¼‰å…¥æª”æ¡ˆ</button>
                </div>
            </div>
            <textarea id="leftText" class="diff-textarea" placeholder="è²¼ä¸Šå…§å®¹æˆ–æ‹–æ›³æª”æ¡ˆè‡³æ­¤..."></textarea>
            <div class="drag-overlay">æ”¾é–‹ä»¥è¼‰å…¥æª”æ¡ˆ A</div>
        </div>

        <div class="input-box" id="rightInputBox">
            <div class="box-header">
                <span id="rightFileName">ğŸ“„ æª”æ¡ˆ B (è®Šæ›´å¾Œ)</span>
                <div>
                    <input type="file" id="rightFileInput" style="display:none" onchange="handleFileSelect('rightText', this)">
                    <button class="btn-outline" style="padding:2px 8px; font-size:12px;" onclick="document.getElementById('rightFileInput').click()">è¼‰å…¥æª”æ¡ˆ</button>
                </div>
            </div>
            <textarea id="rightText" class="diff-textarea" placeholder="è²¼ä¸Šå…§å®¹æˆ–æ‹–æ›³æª”æ¡ˆè‡³æ­¤..."></textarea>
            <div class="drag-overlay">æ”¾é–‹ä»¥è¼‰å…¥æª”æ¡ˆ B</div>
        </div>
    </div>

    <div class="diff-container" id="diffContainer" style="display:none;">
        <div class="diff-stats">
            <span class="stat-badge add">æ–°å¢: <span id="statAdded">0</span></span>
            <span class="stat-badge del">åˆªé™¤: <span id="statRemoved">0</span></span>
            <span class="stat-badge mod">ä¿®æ”¹: <span id="statModified">0</span></span>
            <span style="color:#666; margin-left:auto; font-size:12px;">æ”¯æ´å·¦å³åŒæ­¥æ²å‹•</span>
        </div>

        <div class="diff-minimap" id="diffMinimap">
            <div class="minimap-content" id="minimapContent">
                <div class="minimap-viewport" id="minimapViewport"></div>
            </div>
        </div>

        <div class="diff-panels">
            <div class="diff-panel" id="leftPanel">
                <div id="leftOutput"></div>
            </div>
            <div class="diff-panel" id="rightPanel">
                <div id="rightOutput"></div>
            </div>
        </div>
    </div>
</div>

<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
</div>
<div id="notification" class="notification"></div>

<script>
    (function() {
        // --- é€šç”¨å·¥å…·å‡½æ•¸ ---
        function showNotification(msg, type = 'info') {
            const el = document.getElementById('notification');
            el.textContent = msg;
            el.className = `notification show ${type}`;
            setTimeout(() => el.className = 'notification', 3000);
        }

        function showLoading(show) {
            document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
        }

        // --- å…¨åŸŸè®Šæ•¸ ---
        let isSyncing = false;

        // --- åˆå§‹åŒ–äº‹ä»¶ ---
        window.onload = function() {
            setupFileDrop();
            setupSyncScroll();
        };

        // --- æ ¸å¿ƒé‚è¼¯ï¼šæ¯”å°æ–‡å­— ---
        window.compareTexts = function() {
            const leftText = document.getElementById('leftText').value;
            const rightText = document.getElementById('rightText').value;

            if (!leftText && !rightText) return showNotification('è«‹è¼¸å…¥å…§å®¹æˆ–è¼‰å…¥æª”æ¡ˆ', 'error');

            showLoading(true);

            // ä½¿ç”¨ setTimeout é¿å… UI å¡æ­»
            setTimeout(() => {
                const ignoreWhitespace = document.getElementById('ignoreWhitespace').checked;
                const ignoreCase = document.getElementById('ignoreCase').checked;

                let leftLines = leftText.split('\n');
                let rightLines = rightText.split('\n');

                // é è™•ç†
                const processLine = (line) => {
                    if (ignoreWhitespace) line = line.trim();
                    if (ignoreCase) line = line.toLowerCase();
                    return line;
                };

                const procLeft = leftLines.map(processLine);
                const procRight = rightLines.map(processLine);

                // è¨ˆç®— Diff (LCS æ¼”ç®—æ³•ç°¡åŒ–ç‰ˆ)
                const diff = computeDiff(procLeft, procRight);

                // æ¸²æŸ“çµæœ
                renderDiff(diff, leftLines, rightLines);
                
                document.getElementById('diffContainer').style.display = 'flex';
                showLoading(false);
                showNotification('æ¯”å°å®Œæˆ', 'success');
            }, 100);
        };

        // LCS Diff æ¼”ç®—æ³•
        function computeDiff(left, right) {
            const m = left.length;
            const n = right.length;
            // ç©ºé–“å„ªåŒ–ï¼šåƒ…ç”¨æ–¼ demoï¼Œå¤§æª”æ¡ˆå»ºè­°ä½¿ç”¨æ›´å„ªåŒ–çš„ diff åº«
            if(m * n > 2000000) return computeSimpleDiff(left, right); // è¶…å¤§æª”æ¡ˆç”¨ç°¡å–®æ¯”å°

            const lcs = Array(m + 1).fill(null).map(() => Array(n + 1).fill(0));

            for (let i = 1; i <= m; i++) {
                for (let j = 1; j <= n; j++) {
                    if (left[i - 1] === right[j - 1]) {
                        lcs[i][j] = lcs[i - 1][j - 1] + 1;
                    } else {
                        lcs[i][j] = Math.max(lcs[i - 1][j], lcs[i][j - 1]);
                    }
                }
            }

            const diff = [];
            let i = m, j = n;
            while (i > 0 || j > 0) {
                if (i > 0 && j > 0 && left[i - 1] === right[j - 1]) {
                    diff.unshift({ type: 'unchanged', lIdx: i - 1, rIdx: j - 1 });
                    i--; j--;
                } else if (j > 0 && (i === 0 || lcs[i][j - 1] >= lcs[i - 1][j])) {
                    diff.unshift({ type: 'added', lIdx: null, rIdx: j - 1 });
                    j--;
                } else if (i > 0) {
                    diff.unshift({ type: 'removed', lIdx: i - 1, rIdx: null });
                    i--;
                }
            }
            return diff;
        }

        function computeSimpleDiff(left, right) {
            // ç°¡å–®é€è¡Œæ¯”å° (fallback)
            const diff = [];
            const max = Math.max(left.length, right.length);
            for(let i=0; i<max; i++) {
                if(i >= left.length) diff.push({ type: 'added', lIdx: null, rIdx: i });
                else if(i >= right.length) diff.push({ type: 'removed', lIdx: i, rIdx: null });
                else if(left[i] === right[i]) diff.push({ type: 'unchanged', lIdx: i, rIdx: i });
                else {
                    diff.push({ type: 'removed', lIdx: i, rIdx: null });
                    diff.push({ type: 'added', lIdx: null, rIdx: i });
                }
            }
            return diff;
        }

        // æ¸²æŸ“çµæœ HTML
        function renderDiff(diff, rawLeft, rawRight) {
            const leftOutput = document.getElementById('leftOutput');
            const rightOutput = document.getElementById('rightOutput');
            const minimapContent = document.getElementById('minimapContent');
            const minimapViewport = document.getElementById('minimapViewport'); // ä¿ç•™ viewport

            leftOutput.innerHTML = '';
            rightOutput.innerHTML = '';
            // æ¸…ç©º minimap ä½†ä¿ç•™ viewport å…ƒç´ 
            minimapContent.innerHTML = '';
            minimapContent.appendChild(minimapViewport);

            let added = 0, removed = 0, modified = 0;
            let lNum = 1, rNum = 1;

            // è™•ç† Diff å€å¡Š
            diff.forEach((item, index) => {
                // æª¢æŸ¥æ˜¯å¦ç‚ºä¿®æ”¹ (removed ç·Šæ¥ added)
                let isMod = false;
                if(item.type === 'removed' && index + 1 < diff.length && diff[index+1].type === 'added') {
                    // é€™æ˜¯ä¸€å€‹ç°¡å–®çš„ä¿®æ”¹åµæ¸¬ï¼Œå¯¦éš›å¯åšæ›´ç´°
                }

                // å»ºç«‹å·¦å´è¡Œ
                const lDiv = document.createElement('div');
                lDiv.className = 'diff-line';
                if(item.type === 'removed') {
                    lDiv.innerHTML = createLineHtml(lNum++, rawLeft[item.lIdx], 'removed');
                    removed++;
                    createMinimapLine('removed');
                } else if(item.type === 'unchanged') {
                    lDiv.innerHTML = createLineHtml(lNum++, rawLeft[item.lIdx], '');
                    createMinimapLine('');
                } else {
                    lDiv.innerHTML = createLineHtml('', '', 'empty'); // å³å´æ–°å¢æ™‚ï¼Œå·¦å´ç‚ºç©º
                }
                leftOutput.appendChild(lDiv);

                // å»ºç«‹å³å´è¡Œ
                const rDiv = document.createElement('div');
                rDiv.className = 'diff-line';
                if(item.type === 'added') {
                    rDiv.innerHTML = createLineHtml(rNum++, rawRight[item.rIdx], 'added');
                    added++;
                    // å¦‚æœä¸Šä¸€è¡Œæ˜¯ removedï¼Œé€™ä¸€è¡Œåœ¨ minimap æ¨™è¨˜ç‚º modified æ¯”è¼ƒå¥½è®€
                    // é€™è£¡ç°¡åŒ–è™•ç†ï¼Œç›´æ¥æ¨™è¨˜ added
                    // ä¿®æ­£ï¼šminimap æ‡‰è©²åªç•«ä¸€æ¬¡ï¼Œé€™è£¡é¿å…é‡è¤‡ç•«
                } else if(item.type === 'unchanged') {
                    rDiv.innerHTML = createLineHtml(rNum++, rawRight[item.rIdx], '');
                } else {
                    rDiv.innerHTML = createLineHtml('', '', 'empty'); // å·¦å´åˆªé™¤æ™‚ï¼Œå³å´ç‚ºç©º
                    // ä¿®æ­£ minimap é‚è¼¯ï¼šremoved å·²ç¶“åœ¨ä¸Šé¢ç•«äº†
                }
                rightOutput.appendChild(rDiv);
            });

            // æ›´æ–°çµ±è¨ˆ
            document.getElementById('statAdded').textContent = added;
            document.getElementById('statRemoved').textContent = removed;
            // é€™è£¡çš„é‚è¼¯ï¼šå¦‚æœä¸€å€‹å€å¡Šå…ˆ removed å† addedï¼Œè¦–è¦ºä¸Šæ˜¯ modified
            // ä½†ç‚ºäº†ç°¡åŒ–ï¼Œçµ±è¨ˆä¿æŒåŸæ¨£ï¼Œä½¿ç”¨è€…å¯è‡ªè¡Œåˆ¤æ–·

            // æ›´æ–° Viewport é«˜åº¦æ¯”ä¾‹
            updateMinimapViewport();
        }

        function createLineHtml(num, content, type) {
            const cls = type ? `line-${type}` : '';
            // è½‰ç¾© HTML
            const safeContent = content ? content.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;") : '';
            return `<div class="line-num">${num}</div><div class="line-content ${cls}">${safeContent || '&nbsp;'}</div>`;
        }

        function createMinimapLine(type) {
            const div = document.createElement('div');
            div.className = `minimap-line ${type}`;
            document.getElementById('minimapContent').appendChild(div);
        }

        // --- æ‹–æ›³æª”æ¡ˆè™•ç† ---
        function setupFileDrop() {
            const boxes = ['leftInputBox', 'rightInputBox'];
            boxes.forEach(id => {
                const box = document.getElementById(id);
                const textAreaId = id === 'leftInputBox' ? 'leftText' : 'rightText';
                const fileNameId = id === 'leftInputBox' ? 'leftFileName' : 'rightFileName';

                box.addEventListener('dragover', (e) => { e.preventDefault(); box.classList.add('drag-over'); });
                box.addEventListener('dragleave', (e) => { e.preventDefault(); box.classList.remove('drag-over'); });
                box.addEventListener('drop', (e) => {
                    e.preventDefault();
                    box.classList.remove('drag-over');
                    const file = e.dataTransfer.files[0];
                    if(file) readFile(file, textAreaId, fileNameId);
                });
            });
        }

        window.handleFileSelect = function(textAreaId, input) {
            const file = input.files[0];
            const fileNameId = textAreaId === 'leftText' ? 'leftFileName' : 'rightFileName';
            if(file) readFile(file, textAreaId, fileNameId);
        }

        function readFile(file, textAreaId, fileNameId) {
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById(textAreaId).value = e.target.result;
                document.getElementById(fileNameId).textContent = `ğŸ“„ ${file.name}`;
                showNotification(`å·²è¼‰å…¥ ${file.name}`, 'success');
            };
            reader.readAsText(file);
        }

        // --- åŒæ­¥æ²å‹• & Minimap ---
        function setupSyncScroll() {
            const left = document.getElementById('leftPanel');
            const right = document.getElementById('rightPanel');
            const minimap = document.getElementById('diffMinimap');
            const viewport = document.getElementById('minimapViewport');

            const sync = (source, target) => {
                if(isSyncing) return;
                isSyncing = true;
                target.scrollTop = source.scrollTop;
                target.scrollLeft = source.scrollLeft;
                
                // æ›´æ–° Minimap viewport ä½ç½®
                const percent = source.scrollTop / (source.scrollHeight - source.clientHeight);
                const trackWidth = minimap.clientWidth;
                const viewWidth = viewport.clientWidth;
                const maxLeft = trackWidth - viewWidth;
                
                // é€™è£¡ Minimap æ˜¯æ©«å‘çš„ä»£è¡¨ç¸±å‘å…§å®¹ (ç‚ºäº†çœç©ºé–“) -> æ”¹ç‚ºæ¨™æº–å‚ç›´ Minimap è¼ƒç›´è¦ºï¼Ÿ
                // åŸç‰ˆä»£ç¢¼æ˜¯æ©«å‘çš„ï¼Œæˆ‘å€‘ç¶­æŒæ©«å‘ä½†é‚è¼¯è¦å°
                // å‡è¨­ minimap å¯¬åº¦ = æª”æ¡ˆç¸½è¡Œæ•¸ï¼Œviewport å¯¬åº¦ = å¯è¦–å€åŸŸè¡Œæ•¸
                // é€™è£¡ç°¡åŒ–ï¼šviewport éš¨æ²å‹•ç§»å‹•
                viewport.style.left = (percent * (trackWidth - viewWidth)) + 'px';

                setTimeout(() => isSyncing = false, 50);
            };

            left.addEventListener('scroll', () => sync(left, right));
            right.addEventListener('scroll', () => sync(right, left));
        }
        
        function updateMinimapViewport() {
            // è¨ˆç®— viewport å¯¬åº¦ä½”æ¯”
            const panel = document.getElementById('leftPanel');
            const minimap = document.getElementById('diffMinimap');
            const viewport = document.getElementById('minimapViewport');
            
            if(panel.scrollHeight > panel.clientHeight) {
                const ratio = panel.clientHeight / panel.scrollHeight;
                const width = minimap.clientWidth * ratio;
                viewport.style.width = `${Math.max(20, width)}px`; // è‡³å°‘ 20px
            } else {
                viewport.style.width = '100%';
            }
        }

        // --- å…¶ä»–åŠŸèƒ½ ---
        window.clearAll = function() {
            document.getElementById('leftText').value = '';
            document.getElementById('rightText').value = '';
            document.getElementById('leftFileName').textContent = 'ğŸ“„ æª”æ¡ˆ A (åŸå§‹)';
            document.getElementById('rightFileName').textContent = 'ğŸ“„ æª”æ¡ˆ B (è®Šæ›´å¾Œ)';
            document.getElementById('diffContainer').style.display = 'none';
            showNotification('å·²æ¸…é™¤æ‰€æœ‰å…§å®¹');
        };

        window.toggleFullscreen = function() {
            document.body.classList.toggle('fullscreen-active');
            const btn = document.getElementById('fullscreenBtn');
            if(document.body.classList.contains('fullscreen-active')) {
                btn.textContent = 'ç¸®å°';
                btn.classList.add('btn-primary');
                btn.classList.remove('btn-outline');
            } else {
                btn.textContent = 'â›¶ å…¨è¢å¹•';
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-outline');
            }
        };

    })();
</script>

</body>
</html>